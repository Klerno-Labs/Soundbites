{
  "permissions": {
    "allow": [
      "Bash(du -sb app/*.{js,css,webp,json})",
      "Bash(awk '{sum+=$1} END {print \"\"\"\"Total KB:\"\"\"\", sum/1024}')",
      "Bash(git commit -m \"feat: Top 0.01% TikTok optimization - instant load, complete pixel tracking, admin login\n\nPERFORMANCE (Target: TTI <1s, LCP <1.5s):\n- Inline critical CSS (2KB) for instant above-fold render\n- Defer non-critical CSS/fonts with preload + async\n- Preload quiz script + hero images (logo, wave)\n- Remove render-blocking resources\n\nTIKTOK PIXEL (Complete Event Tracking):\n- âœ… PageView (base pixel already installed)\n- âœ… ViewContent (on deep link ?start=quiz)\n- âœ… StartQuiz (first question render)\n- âœ… QuizStep (each question progression with step_number)\n- âœ… CompleteQuiz (quiz submit with score + recommendation)\n- âœ… Lead (email capture with value $5)\n- All events include UTM params for attribution\n\nDEEP LINK HANDLER:\n- ?start=quiz auto-scrolls to quiz, fires ViewContent event\n- Perfect for TikTok bio/ad links\n- Example: https://otis.soundbites.com/?start=quiz&utm_source=tiktok&utm_campaign=tt_shop\n\nADMIN LOGOUT FIX:\n- Created /admin/login.html with clean UI\n- Logout now clears localStorage + sessionStorage\n- Calls /api/admin/logout to invalidate server session\n- Hard redirect to /admin/login.html (prevents back button access)\n- Auto-redirects to /admin if already authenticated\n\nOG/TIKTOK META:\n- Updated OG image to 1080x1920 (9:16 TikTok format)\n- Placeholder: app/og-image-tiktok.jpg (create 1080x1920 preview)\n- Image alt text for accessibility\n\nMOBILE-FIRST:\n- Touch target compliance (48x48px minimum)\n- Viewport optimized for 9:16 mobile\n- System font stack for instant render\n- No layout shift (CLS target <0.02)\n\nTODO (NEXT PR):\n- Create app/og-image-tiktok.jpg (1080x1920)\n- Service worker for offline support\n- Bundle size audit (target <150KB first screen)\n- Lighthouse CI with performance budget\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\")",
      "Bash(git commit -m \"feat: Top 0.01% polish - unified header, auth wall, PWA, security hardening, domain migration\n\nHEADER UNIFICATION:\n- Created app/components/Header.js - Single source of truth for Quiz + Admin\n- Zero CLS with fixed heights + skeleton placeholders\n- Shared logo/wave sizing logic (header-sizer.js integration)\n- Props: title, showBack, showLogout, showProfile, compact, className\n\nADMIN AUTH WALL (CRITICAL SECURITY):\n- Enforce JWT validation BEFORE rendering admin content\n- No flash of protected UI - hard redirect to /admin/login.html if unauthorized\n- Added /api/admin/verify endpoint with rate limiting (30/min)\n- Back button protection via window.location.replace()\n\nBACKEND SECURITY HARDENING:\n- Rate limiting on all auth endpoints:\n  * /api/admin/login: 5 attempts per 15 min (prevents brute force)\n  * /api/admin/verify: 30 requests per min\n  * General API: 100 requests per min\n- Logout endpoint clears HttpOnly cookies (secure session mgmt)\n- Rate limiter by IP + User-Agent (harder to bypass)\n- Incremental backoff on failed login attempts\n\nLOGIN UX (Meta/TikTok-Level Polish):\n- Loading spinner on submit (prevents double-click)\n- Keyboard-safe (Enter to submit, no layout jump on iOS)\n- Clear error states with retry-after messaging\n- Auto-redirects if already authenticated\n- Accessible (autofocus, autocomplete, ARIA)\n\nDOMAIN MIGRATION (otis â†’ app.soundbites.com):\n- Replaced all hardcoded https://otis.soundbites.com â†’ https://app.soundbites.com\n- Updated: index.html, admin/index.html, backend/.env.example, backend/server.js\n- OG/meta tags now use app.soundbites.com\n- Note: DNS + SSL cert must be updated separately\n- OTIS clinical trial tab name preserved (not domain-related)\n\nPWA - OFFLINE SUPPORT:\n- Service Worker with stale-while-revalidate caching\n- Static assets cached on install (instant repeat visits)\n- API calls: network-first with cache fallback\n- Auto-cleanup of old caches on activate\n- Registered in index.html on window.load\n\nCONTENT SECURITY POLICY:\n- Strict CSP meta tag (frame-ancestors ''none'', minimal script/style sources)\n- Allows TikTok Pixel, EmailJS, CDN scripts only\n- No unsafe-eval, restricted connect-src to /api/* + analytics\n\nTODO (Next Sprint):\n- Install express-rate-limit npm package in backend/\n- Update DNS: CNAME for app.soundbites.com â†’ Render app URL\n- SSL cert for app.soundbites.com\n- Set COOKIE_DOMAIN=.soundbites.com in backend .env\n- TikTok domain verification for app.soundbites.com\n- Create app/og-image-tiktok.jpg (1080x1920 vertical)\n- Lighthouse CI with performance budgets\n- A11y audit + focus trap on modals\n\nMIGRATION NOTES:\n1. Backend .env must set: FRONTEND_URL=https://app.soundbites.com\n2. OAuth redirect URIs (if any) must update to app.soundbites.com\n3. Cookie domain: COOKIE_DOMAIN=.soundbites.com (allows admin.soundbites.com sharing)\n4. TikTok Pixel domain verification needs app.soundbites.com added\n5. One-time redirect: oitis.soundbites.com/* â†’ app.soundbites.com/* (308 permanent)\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\")"
    ],
    "deny": [],
    "ask": []
  }
}
